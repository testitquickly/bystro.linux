Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2022-02-23T00:50:15+02:00

====== Update ======

[ @debian @update ]

[[Проверить:Версия и релиз Debian]]

===== Дежурное обновление системы =====

''sudo apt update && sudo apt upgrade''

Раньше использовали команду ''apt-get'', которая ныне считается устаревшей.

===== Обновление до определённого ядра =====

Сперва надо знать точный номер ядра, к которому нужно обновиться — [[HowTo:Проверить:Какие ядра есть в системе]] — и причина для обновления должна быть обоснована. 

	Всегда есть вероятность нафакапиться, поэтому продвигаться надо осторожно, всегда проверяя, можно ли откатиться к предыдущему состоянию. 
	
	При обновлении ядер разумно поставить их несколько совместно и явно указать в загрузке более новое. Если что — откатиться.

''sudo aptitude update''
	
Списки пакетов обновляются из всех репозиториев, указанных в файле /etc/apt/sources.list а также в Система > Менеджер пакетов Synaptic > Настройки > Репозитории > Other Software 

	1. ''sudo aptitude install REQUIRED-linux-image-version''
	2. ''sudo reboot''

Если после загрузки все идёт хорошо, тогда подтягиваем зависимости для нового ядра, разрешив Debian автоматом удалять старые зависимости:

''sudo aptitude full-upgrade''

===== Обновление до нового релиза =====

Отслеживать порядковый номер и имя доступных релизов — https://www.debian.org/releases/

==== Проверить Desktop Environment ====

Если уже давно всё в порядке в условной Plasma 5, а в новой версии Debian есть только условная Plasma 6, то обновление будет болезненным, потому что одинаковое у них только название, а внутри новая Plasma — вообще другое окружение, и не факт, что все привычные виджеты, темы и возможности Plasma уже обновились до Plasma 6. Например, та же Plasma 6 была выпущена 28 февраля 2024; уже конец 2025-го, а [[Настроить:Внешний вид KDE:Виджет «Календарь событий»]] в Plasma 6 еще не работает.

В какой-то из уже забытых дней именно такое предсказуемо-неизбежное, но всё-таки ВНЕЗАПНОЕ обновление KDE в [[Manjaro]] вызвало у скромного автора сих строк нескромный, блять, баттхёрт (взрыв жопы). В один момент всё наработанное, удобное, настроенное — исчезло; вот тебе, братан, вроде бы тот же KDE, но уже без половины привычных виджетов — на, настраивай заново… И нет, ничего не поломалось и файлы не исчезли, просто Arch (и его подельник Manjaro) развивается по схеме роллинг-релиз, и мы уже обновились, и Plasma 5 уже отключена навсегда. Ну, кагбэ…

==== Проверить ПО ====

Глянуть в 

'''
ls /etc/apt/sources.list.d/
'''

Если там есть неординарные, но используемые источники ПО (вроде [[Software:Brave]], [[Software:Sublime]] или [[Software:pgAdmin]]) — сперва узнать (на Reddit), работают ли они в новой версии. 

Если нет:

* или отключить их
* или отложить апгрейд системы.

==== Озаботиться бэкапом ====

Хорошо бы сделать бэкап данных, потому что //shit happens//, гарантий нет.

1. резервная копия /home и всех партиций с данными
2. бэкап нужных конфигов системы
	a. каталоги /etc, 
	b. базу пакетов /var/lib/dpkg, 
	c. файл /var/lib/apt/extended_states, 
	d. список установленных пакетов (dpkg --get-selections '*')

==== Обновить систему до последнего возможного уровня ====

Если всё ок и идем дальше:

''sudo apt update && sudo apt upgrade -y''

''sudo apt --purge autoremove''

''sudo apt autoclean''

Убрать “зависшие” пакеты, “на удержании” (hold):

''apt-mark showhold''

Если что-то зафиксировано, разблокировать:

''sudo apt-mark unhold'' __''имя_пакета''__

Проверить статус пакетов через

''dpkg --audit''

В ответ ждем пустоту.

==== Обновить sources.list ====

[[Обновить sources.list]] по имени нового релиза. Затем

''sudo apt update''

==== Обновить систему до нового релиза ====

Дальше тоже можно использовать ''apt'', но есть смысл идти через ''aptitude'', которая вроде бы делает то же самое, но менее грубо и с чуть большей чуткостью.

=== Минимальное обновление ===

Без новых пакетов:

''sudo apt upgrade --without-new-pkgs''

Если появятся сложности — разрулить их.

=== Полное обновление системы ===

''sudo aptitude full-upgrade''

Команда //full-upgrade// изначально назвывалась //dist-upgrade//. aptitude все ещё распознает dist-upgrade как синоним full-upgrade. Но «//aptitude full-upgrade»// обновляет установленные пакеты до их наиболее свежих версий, удаляя или устанавливая пакеты, если это необходимо. Также выполняется установка новых необходимых и требующихся пакетов. Эта команда менее консервативна (более агрессивна) чем «//safe-upgrade»//, и потому более вероятно, что она произведёт нежелательные действия. Тем не менее, она способна обновить пакеты, которые не могут быть обновлены командной «//safe-upgrade//».

Если в командной строке после этой команды не указан ни один пакет, aptitude попытается обновить //каждый// пакет, который может быть обновлён. Если что-то не получается — сообщит о проблеме.

После завершения:

''sudo apt --purge autoremove''
''sudo apt autoclean''

Затем „''sudo reboot''” и посмотреть, что получилось. 

Глянуть версию Debian:

''lsb_release -d''
или
''cat /etc/debian_version''

И еще раз:

''sudo apt update && sudo apt upgrade''

Обычно надо заново [[Настроить:Поменять местами символы на клавише точки и запятой в русской раскладке]], иногда меняется конфиг для [[Настроить:GRUB2]].

Могут быть устаревшие пакеты (obsolete) — их предложат удалить.

==== Если обновления проверяются только из кэша ====

[[Заставить aptitude обновляться из сети, а не из кэша]]
