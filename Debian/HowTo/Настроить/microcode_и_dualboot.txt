Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2022-03-14T23:48:53+02:00

====== microcode и dualboot ======

[ @debian @windows10 @microcode @dualboot ]

Debian отказался загружаться.

При загрузке включается ''emergency mode и предлагается'' ввести пароль root 'for maintenance'. Дальше компьютер ждёт команды и ничего не подсказывает. 

Смотрим журнал загрузки:

''journalctl -xb''

	Можно ''systemctl -xb''

Многоэкранный список всего можно пролистывать клавишей Space.

 Спустя много экранов и разноцветных букв в глаза бросается строка красного цвета '//fsck failed with exit status 4//'.

Чуть ниже ’''Failed to start File System Check on /dev/disk/by-uuid/3df3223a-1d70-4042-8f76-e575e0acda46''’ — набор букв и цифр, которые идентифицируют загрузочный диск.

Также заметны сообщения о том, что не запущен network. Апдейты и установка чего-либо невозможна.

Самое явное сообщение о проблеме: 

	''[Firmware bug> TSC_DEADLINE disabled due to Errata; please update microcode to version: 0x25 or later'' (цифра версии может отличаться).

===== Объяснение проблемы =====

У меня dual boot: вин10 и Debian 11 на ssd. При загрузке Debian автоматически в режиме редактирования происходит и mount партиции с виндой.

Я не уверен, но предполагаю, что по какой-то причине виндовая партиция не была должным образом отключена. Линукс это «видит» при своей загрузке,  и из осторожности запрещает загружать всё сразу, принудительно переводя машину в ''emergency mode''.

Система отключила часть функциональности при загрузке и «ждёт», когда проблема будет решена.

==== Пошуршить в винде ====

1) Вероятно, есть незавершенное обновление. Если его не удаётся применить — вероятно, на диске с виндой нет свободного места. Убрать всё, что можно. Пяти свободных гигов должно хватить на всё.

2) Очистить корзину.

3) Запустить cmd из-под админа (правой кнопкой по Start > Command Prompt (Admin) и прогнать **chkdsk c:**

	Если будут обнаружены ошибки на загрузочном диске, то система сообщит CHKDSK Cannot Continue in Read-only Mode. Это нормально, бо нельзя обработать диск в системе, которая уже загружена. Надо запланировать этот прогон при следующей загрузке:

	1. "Command Prompt (Admin)" option.
	2. Click "Yes" when you are presented with a UAC window requesting permission to launch the Command Prompt as Administrator.
	3. In the Command Prompt window, type chkdsk /r c: (если речь идет про диск С, конечно) and press Enter.
	4. Click "Y" when you are asked if want CHKDSK  to run when the system restarts next.   
	5. Restart the system, CHKDSK will be automatically launched to check and repair disk errors in Windows. Этот процесс нельзя прерывать.

4) Накатить все апдейты, если это возможно. Ни в коем случае не прерывать этот бесконечный процесс. Очевидно, что потребуется сделать несколько перезагрузок, при этом всегда есть вероятность того, что завершить обновления не удастся, и произойдёт их отмена (и ещё перезагрузки).

===== Debian =====

Поскольку было сообщение о том, что '//Failed to start File System Check on /dev/disk/by-uuid/// и дальше набор букв и цифр, которые идентифицируют загрузочный диск', можно запустить **fsck** на тот самый диск, который не хочет загружаться

''fsck -y /dev/disk/by-uuid/3df3223a-1d70-4042-8f76-e575e0acda46''

Пути подхватываются через Tab, поэтому набирать всю эту абракадабру не придётся.

Если всё пройдёт хорошо: пишем команду reboot и ждём нормальную загрузку системы.
