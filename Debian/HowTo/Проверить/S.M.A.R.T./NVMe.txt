Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2024-10-28T11:37:47+02:00

====== NVMe ======

[ @smart @nvme ]

При загрузке компьютера могут быть сообщения вроде

''smartd[874]: Device: /dev/nvme0, number of Error Log entries increased from 13 to 14''
''smartd[874]: Device: /dev/nvme1, number of Error Log entries increased from 10 to 12''

Это повод если не волноваться, то хотя бы перепроверить состояние «дисков».

''sudo apt install nvme-cli''

''sudo nvme smart-log /dev/nvme0''

Или какое там имя у SSD, вроде

''sudo nvme smart-log /dev/nvme1''

Смотреть:

* ''critical_warning'': Предупреждения о состоянии устройства.
* ''percentage_used'': Уровень износа накопителя.
* ''media_errors'': Ошибки чтения/записи.
* ''num_err_log_entries'': Количество записей в журнале ошибок.

Смотреть их по-отдельности:

''sudo nvme smart-log /dev/nvme0 | grep critical_warning''

Подробный журнал ошибок лучше сохранить в отдельный файл, в консоль он не поместится:

''sudo nvme error-log /dev/nvme0 > ssd0_log.txt''
''sudo nvme error-log /dev/nvme1 > ssd0_log.txt''

и так далее.

Эти команды покажут детали каждой ошибки, включая код ошибки и операцию, вызвавшую её.

Вероятно, пора уже настроить мониторинг состояния с помощью smartd или других инструментов, чтобы оперативно реагировать на новые ошибки.

===== Одиночные ошибки =====

Если количество ошибок увеличивается редко и накопители продолжают нормально работать, это может быть связано с незначительными сбоями (например, потеря питания или программная ошибка). 

==== Сбои питания ====

Проверить журнал системы на наличие сообщений о сбоях питания:

''journalctl | grep -i power''

Убедиться в том, что установлена последняя версия прошивки для материнской платы и NVMe-дисков (это нельзя делать, если диски подключены и используются):

''sudo fsck -f /dev/nvme0n1''
''sudo fsck -f /dev/nvme1n1''

===== Повторяющиеся ошибки =====

Если ошибки появляются регулярно, это может свидетельствовать о:
* проблемах с самим накопителем (например, износ памяти, сбой контроллера).
* проблемах с подключением (плохой контакт, сбой кабелей или слота).
* изношенности: если параметр Percentage Used приближается к 100%, накопитель необходимо заменить.

Решение:
* проверить подключение устройств (особенно для U.2 накопителей).

''sudo nvme fw-log /dev/nvme0''

* обновить прошивку накопителей, если это возможно:

''sudo nvme fw-download --fw=''__''<путь к прошивке>''__ ''/dev/nvme0''
