Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2023-10-22T22:59:26+03:00

====== hplip ======

[ @debian @printer @scaner @drivers @xsane @hp @install ]

„''hplip''” (HP Device Manager) — это общий набор драйверов и система управления для принтеров/сканеров HP.

Надо будет перезагрузить компьютер.

===== Установить =====

Надо: 
* отключить принтер от компьютера
* убедиться в том, что в ''/apt/sources.list'' нет установки ПО с установочного диска — нужны только сетевые ресурсы
* убедиться в том, что любые package management systems (YaST, Adept, Synaptic, Up2date, etc) не задействованы
* согласиться с тем, что в ходе установки будет установлен AppArmor

Установить CUPS (Common Unix Printing System), используется для управления печатью на Linux:

''sudo apt install cups''

Запустить сервис CUPS (должен всегда загружаться вместе с системой):

''sudo systemctl enable --now cups''
''sudo systemctl start cups''

Установить базовое ПО для сканирования:

''sudo apt update && sudo apt install -y sane-utils libsane sane xsane''

===== Автоматическая установка =====

1. https://developers.hp.com/hp-linux-imaging-and-printing/gethplip
2. выбрать «свой linux» из выпадающего списка,
3. получить файл вроде „hplip-3.23.8.run”,\
4. положить его в каталог, полный путь к которому НЕ содержит пробелы
5. сделать его выполняемым
	a. ''chmod u+x hplip-3.23.8.run''
6. выполнить его согласно официальной [[https://developers.hp.com/hp-linux-imaging-and-printing/install/install/index|инструкции]].

''./hplip-3.23.8.run''
или
''sh /hplip-3.23.8.run''

Для сборки системе понадобится собрать множество других пакетов, поэтому это всё __НАДОЛГО__ (но если уже прошёл час, то можно всё отменять и искать более старый скрипт установки) и с риском поломаться в любой момент. Надо присматривать за процессом и не отходить далеко, потому что в какой-то момент будет запрошен пароль или выбор юзера.

Во всех источниках после этого рекомендуется перезагрузить компьютер, но не факт, что это понадобится.

===== Ручная установка =====

Согласно https://developers.hp.com/hp-linux-imaging-and-printing/install/manual/distros/debian — но там может быть старый текст.

но сперва лучше посмотреть https://developers.hp.com/hp-linux-imaging-and-printing/install/manual/distros/other

Убедиться в том, что сперва установлен [[Software:Python]]

Переключиться под root:

''su''

Можно выполнить всё в одной строке, но со временем то одно отпадает, то другое, поэтому лучше выполнять их по-отдельности. Вероятно, какие-то из перечисленных пакетов отсутствуют. Прочитать ответ и принять решение по каждому.

''apt install build-essential''

''apt install -y libavahi-core-dev libavahi-client-dev libcups2 libcups2-dev cups-bsd cups-client libcupsimage2 libcupsimage2-dev libdbus-1-dev g++ libssl-dev libjpeg62-turbo-dev libsnmp-dev libc6 libtool libusb-1.0-0-dev''

''apt install -y libsane-dev sane-utils sane xsane''

''apt install -y policykit-1 policykit-1-gnome'' 

''apt install -y python-dbus python-imaging python3-dev python3-pyqt5 python-qt4 python-qt4-dbus python-gobject python-notify python-reportlab python-is-python3 python-dev-is-python3 2to3''

''sudo apt install colord icc-profiles''

В частности, раньше надо было ставить „gs-esp” и „libjpeg62-dev”, но они уже недоступны. Наличие пакета в репозитории проверяется через 

''aptitude search ПАКЕТ''

Скачать установочные файлы — http://prdownloads.sourceforge.net/hplip/hplip-3.12.6.tar.gz

Распаковать файл:

''tar xvfz hplip-3.12.6.tar.gz''

Появится каталог с файлами. Перейти в него:

''cd hplip-3.12.6''

Выполнить:

''./configure --with-hpppddir=/usr/share/ppd/HP --libdir=/usr/lib64 --prefix=/usr --enable-qt4 --disable-libusb01_build --enable-doc-build --disable-cups-ppd-install --disable-foomatic-drv-install --disable-foomatic-ppd-install --disable-hpijs-install --disable-udev_sysfs_rules --disable-policykit --enable-cups-drv-install --enable-hpcups-install --enable-network-build --enable-dbus-build --enable-scan-build --enable-fax-build''

Разные параметры конфигурации см. https://developers.hp.com/hp-linux-imaging-and-printing/install/manual/distros/debian#

Выполнить эту команду из-под своего юзера (NOT root):

''make''

Если ошибок не будет, сделать установку из-под root:

''su -c "make install"''

Добавить своего юзера в группу "lp":

''su -c "/usr/sbin/usermod -a -G lp astenix"''

Reboot.

===== Подключить принтер к компьютеру =====

==== Проверить группу юзера ====

''id astenix''

В ответе см: 

''7(lp),114(lpadmin),118(scanner)''

==== Сделать ручную настройку HP ====

Не факт, что всё будет установлено как задумано, установочный скрипт hplip может быть заточен под ПО, которое уже не поддерживается (вроде PyQt4). Вызвать его ручную настройку в консоли:

''hp-setup -i''

После выполнения всех шагов в ''/etc/cups/ppd/'' появится файл с настройками принтера: ''*.ppd''

==== Подключить принтер ====

''Параметры системы''
''> Оборудование''
''> Принтеры''

Если принтер подключен через роутер — указать его ip.

implicitclass://HP_LaserJet_Tank_MFP_2602dn_0483F1/

На шаге выбора драйверов выбрать путь к файлу ppd (настройки).

Есть вероятность, что принтер уже был подключен через другой драйвер, например, driverless. Не факт, что это будет работать, поэтому 
Настроить
> Изменение принтера
> Драйвер
> Выбрать другой драйвер
> Указать файл ppd
Найти его в ''/etc/cups/ppd/'' 

Если можно выполнить тестовую печать — все гуд. Если нет — алярм, смотреть https://developers.hp.com/hp-linux-imaging-and-printing/install/manual/hp_setup

=== Переименовать текущий принтер ===

Узнать полный путь к принтеру:

''lpstat -v HP_LaserJet_Tank_MFP_2602dn_0483F1''

Пример ответа:

'''
устройство для HP_LaserJet_Tank_MFP_2602dn_0483F1: implicitclass://HP_LaserJet_Tank_MFP_2602dn_0483F1/
'''

Задать новое имя принтера и сразу скопировать настройки от существующего:

''sudo lpadmin -p HP_2602dn -v'' [[socket://192.168.1.13|''socket://192.168.1.13'']] ''-E -P /etc/cups/ppd/HP_LaserJet_Tank_MFP_2602dn_0483F1.ppd''


''sudo lpadmin -p HP_2602dn -v $(lpstat -v HP_LaserJet_Tank_MFP_2602dn_0483F1 | awk '{print $3}') -E -P /etc/cups/ppd/HP_LaserJet_Tank_MFP_2602dn_0483F1.ppd''

Удалить старое имя

''sudo lpadmin -x HP_LaserJet_Tank_MFP_2602dn_0483F1''  

Проверить результат:

''lpstat -p | awk '{print $2}'''

==== Утилита управления принтерами ====

''sudo apt install hplip hplip-gui''

==== Открыть управление принтерами ====

http://localhost:631/

Логин-пароль: от своего юзера.

Выберите Printers → ваш принтер HP MFP 2602dn → Administration → Set Default Options

В разделе Color Options (или Color Management) ищите Color Profile или Output Profile.

Если поле пустое, укажите путь к вашему ICC-профилю или выберите профиль из списка.

==== Посмотреть доступные сканеры ====

''scanimage -L''

Условный ответ:

'''
device `hpaio:/net/hp_laserjet_tank_mfp_260x?ip=192.168.50.13&queue=false' is a Hewlett-Packard hp_laserjet_tank_mfp_260x all-in-one
device `escl:https://192.168.50.13:443' is a HP LaserJet Tank MFP 2602dn (0483F1) platen scanner
'''

Вызвать ''xsane'', найти устройство (подразумевается что сетевой МФУ будет работать через ''airscan'') и выполнить тестовое сканирование.

Если не нравится ''xsane'':
* “Skanlite” — базовое сканирование
* “Skanpage” — для создания многостраничных документов
* “Simple-scan” — для Gnome, но работает и в KDE

''sudo apt install skanlite skanpage simple-scan''

===== Добавление устройства через CUPS =====

Откройте веб-интерфейс CUPS в браузере:

http://localhost:631

Перейдите в Administration → Add Printer, выберите ваше устройство HP и настройте его.

См. дальше [[Hardware:Принтеры и Сканеры:HP (Hewlett-Packard)]]
