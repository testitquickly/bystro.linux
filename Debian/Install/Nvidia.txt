Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2024-12-18T09:26:27+02:00

====== Nvidia ======

[ @debian @install @nvidia @drivers @video ]

Если надо подключить внешний монитор через видеокарту от Nvidia, то сперва надо убедиться в том, что **монитор НЕ подключен к ноуту**.

Драйвера можно скачать с официального сайта в виде файла ***.run, но лучше сделать это стандартным путём по предписанному рецепту с https://wiki.debian.org/NvidiaGraphicsDrivers — при установке будет проще с зависимостями, а в будущем будет проще с обновлениями.

//Придётся перезагружать компьютер.//

===== Определить серию и драйвера видеокарты =====

Прочитать внимательно https://wiki.debian.org/NvidiaGraphicsDrivers — посмотреть раздел про свою версию OS. 

Надо решить, ставить ли новейшие драйвера (но тогда будет нужен бэкпорт, что для Stable не очень хорошо), или те, что постарее (но не факт, что с ними заработает новая видеокарта). Чем новее драйвера — тем лучше, но к бэкпорту всегда надо относиться с большим подозрением.

Сперва проверить

''nvidia-smi''

Если драйверов нет, то в ответ придет предложение их установить и, вероятно, сперва надо посмотреть подсказку о том, какие именно драйвера подойдут к действующей видеокарте. 

''sudo apt-get install nvidia-detect; nvidia-detect''

Смотреть на вывод. Внимание к сообщениям вроде

''Checking card:  NVIDIA Corporation AD104 [GeForce RTX 4070 SUPER] (rev a1)''
''Uh oh. Your card is not supported by any driver version up to 535.247.01.''
''A newer driver may add support for your card.''
''Newer driver releases may be available in backports, unstable or experimental.''

Смотреть на нумерацию драйвера.

===== Обычная установка =====

Согласно  https://wiki.debian.org/NvidiaGraphicsDrivers :

''sudo apt update; sudo apt install nvidia-driver nvidia-settings firmware-misc-nonfree''

Перезагрузить систему, чтобы переключить видео с Noveau на Nvidia:

''sudo reboot''

Проверить установку драйвера:

''nvidia-smi''

Ожидаемый ответ: таблица с информацией о видеокарте и драйвере.

===== Установка через бэкпорт =====

Не факт, что нужно двигаться по этой ветке, если на компьютере Debian Stable. Она только для тех, кого поглощает отчаяние.

==== Разрешить бэкпорт ====

''sudo mcedit /etc/apt/sources.list''

Дважды перепроверить название дистрибутива. 

Добавить в строку для снятия main апдейтов добавить открытие бэкпорта. В норме обращаемся к „''deb.debian.org/debian/”, но адрес сервера может быть любым из наиболее подходящих'':

	''# main (plus backports for nvidia drivers)''
''deb http://deb.debian.org/debian'' __''bookworm''__''-backports main contrib non-free non-free-firmware''

Сохранить изменения.

''sudo apt update && sudo apt upgrade''

==== Установить драйвера из backports ====

Эта команда может поменяться, ее надо перепроверить на шаге «**Определить серию и драйвера видеокарты**»:

''sudo apt install -t bookworm-backports nvidia-driver firmware-misc-nonfree''

Будет установлен пакет //nvidia-kernel-dkms//. 

При установке драйвер Nouveau не будет удалён (это и не надо), но он автоматически заблэклистится: появится файл ///etc/modprobe.d/blacklist-nvidia-nouveau.conf// с содержимым «blacklist nouveau»

	Можно (если свербит) ещё добавить файл ''sudo mcedit /etc/modprobe.d/blacklist.conf'' с перечнем всех модулей всех свободных драйверов:
		* blacklist vga16fb
		* blacklist nouveau
		* blacklist rivafb
		* blacklist nvidiafb
		* blacklist rivatv
	Но это уже ни на что не повлияет.

''sudo reboot''

==== Обновить систему ====

''sudo apt-get update && sudo apt-get upgrade''

Если будут устаревшие пакеты nvidia, их будет предложено автоудалить:

''sudo apt autoremove''

Затем ещё раз 

''sudo apt-get update && sudo apt-get upgrade''

Убедиться в том, что драйвер работает:

''nvidia-smi''

В ответ ожидаем таблицу с данными о драйвере и видеокарте.

===== Установить утилиту контроля настроек nvidia =====

Вероятнее всего, она уже была незаметно установлена вместе с драйверами:

В списке программ > Настройка появится «NVIDIA X Server Settings». Если она успешно запускается, то уже почти всё норм. Если нет:

''sudo aptitude install nvidia-settings''

===== Установка CUDA Toolkit =====

Сперва надо проверить соответствие установленных драйверов Nvidia и версии CUDA Toolkit — они должны быть синхронизированы. Есть вероятность, что в Debian Stable драйвера для Nvidia будут «более старыми», нежели… Тогда надо установить драйвера через бэкпорт. Но сперва три раза перепровериться и убедиться в том, что новые драйвера нужны.

Если решено ставить CUDA Toolkit отдельно, то сперва надо знать, что эта установка потребует много места на диске с системой. Это решается только установкой CUDA Toolkit через ''run''-файл.

Скачать установщик CUDA с официального сайта https://developer.nvidia.com/cuda-downloads — выбрать Linux, архитектуру (x86_64), OS (Debian), версию (12)  и инсталлер runfile (local), скачать предлагаемой командой (взять с сайта, она изменчивая):

''wget https://developer.download.nvidia.com/compute/cuda/13.0.2/local_installers/cuda_13.0.2_580.95.05_linux.run''

Сделать скачанный файл исполняемым:

''chmod +x cuda*.run''

Установить CUDA Toolkit в отдельный каталог (на отдельном диске):

''sudo ./cuda_*.run --silent --toolkit --installpath=''__''/your_cuda_folder''__

''--silent'' — без дополнительных вопросов; на экран ничего не выводится, надо терпеливо ждать завершения установки
''--toolkit'' — установить только CUDA Toolkit, без драйверов и компонентов для разработчиков

==== Настроить переменные окружения ====

''mcedit ~/.bashrc''

добавить:

''export PATH=''__''/your_cuda_folder''__''/bin:$PATH''
''export LD_LIBRARY_PATH=''__''/your_cuda_folder''__''/lib64:$LD_LIBRARY_PATH''

Применить изменения:

''source ~/.bashrc''

==== Проверить установку ====

''nvcc --version''

Пример ответа:

''nvcc: NVIDIA (R) Cuda compiler driver''
''Copyright (c) 2005-2025 NVIDIA Corporation''
''Built on Wed_Aug_20_01:58:59_PM_PDT_2025''
''Cuda compilation tools, release 13.0, V13.0.88''
''Build cuda_13.0.r13.0/compiler.36424714_0''

Если «команда не найдена» — проверить, что утилита ''nvcc'' действительно находится в __''/your_cuda_folder''__/cuda/bin/ и что PATH указан правильно.
