Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2022-03-18T21:32:00+02:00

====== snap ======

[ @gnome @snap @console ]

snap — это изоляционное окружение для софта, которое сделали в Canonical (то есть, это Gnome для Ubuntu). Ещё есть [[flatpak]] и другие.

Что ценно: можно поставить софт, при этом система остаётся стабильной, бо с ёё точки зрения ничего не меняется.

''sudo apt install evolution'' — и почтовик Evolution ставится в систему. У меня KDE, Evolution из Gnome, и тем не менее, всё работает.

Что не ценно: 
* Почтовик Evolution ставится в систему не из центрального репозитория Debian, а из отдельного, из Canonical. Это естественно и ожидаемо, но если я захочу установить chromium, который есть в Deb, то snap этот запрос (скорее всего) перехватит и поставит от своего имени из своих репозиториев. 
* Даже если нет никакого софта, которое ставится через snap, этот сервис всё равно постоянно присутствует и отнимает несколько копеек полезной нагрузки.

===== Как удалить snap =====

==== Проверить уже установленные snap packages ====

''snap list''

Если там только bare, core, core18, gnome-3-28-1804, gtk-common-themes, wine-platform-6-stable, wine-platform-runtime — значит, нет софта под snap, есть только его обязательная основа.

Если же есть, то их сперва надо удалить:

''sudo snap remove --purge ИМЯ_ПАКЕТА''

==== Очистить кэш snap ====

''sudo rm -rf /var/cache/snapd/''

==== Удалить snap и его GUI ====

''sudo apt autoremove --purge snapd gnome-software-plugin-snap''

Тут надо аккуратно смотреть, что при удалении будет удаляться. У меня было предложено удалить linux-image-5.10.0-8-amd64* snapd* squashfs-tools*. Это было ок, бо в системе уже лежали три ядра, использовалось же 5.10.0-10, поэтому убрать старое было ок. Вместе с ним унеслось какое-то количество пакетов, связанных с nvidia-legacy-390xx.

==== Удалить настройки snap из своей домашней каталогии ====

''rm -fr ~/snap''

==== Заморозить пакет snap (чтобы не обновлялся) ====

''sudo apt-mark hold snapd''

Прах покойного был вынесен на руках безутешных транзисторов.

snap был последним сервисом, который слегка влиял на скорость загрузки моей системы (см. [[blame]])

С ним systemd-analyze сообщал про

	'''
	Startup finished in 3.971s (kernel) + 4.528s (userspace) = 8.499s
	graphical.target reached after 4.521s in userspace
	'''

Без него

	'''
	Startup finished in 4.022s (kernel) + 3.763s (userspace) = 7.786s
	graphical.target reached after 3.742s in userspace
	'''

Ускорение на секунду. Ну, ок. Полная загрузка GUI всё равно занимает всё те же 55-59 секунд ожидания, поэтому киллить snap по вопросам реального ускорения нецелесообразно.

