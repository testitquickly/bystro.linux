Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2025-10-28T04:38:26+02:00

====== mpv ======

[ @mpv @video @subtitles ]

Условно простой, но замечательный видеоплеер.

Особенности:

* шорткаты можно переназначить только через конфигурационный файл
* нет плэйлистов. Можно через ''ls > list.m3u'' сделать текстовый файл с перечнем видео в каталоге (или в разных каталогах) и запустить плеер из консоли с этим файлом как параметр:

''ls | grep -v '\.m3u$' | sort -f > playlist.m3u && mpv playlist.m3u''

Команда ''grep -v '\.m3u$''' нужна потому, что bash сперва создаёт файл, в который будет записан вывод содержимого каталога, и только потом вызывавает список файлов (''ls''), и получается, что файл появляется ДО того, как будет получено содержимое каталога, и он тоже будет записан в список файлов, что вызовет бесконечное зацикливание плейлиста.

===== Звук =====

Если нет многоканальной аудиосистемы, есть смысл принудительно свести многоканальный звук в стерео (даунмикс). Не факт, что разница будет явно очевидна на слух, но есть ситуации, когда звук явно предназначен для прослушивания на многоканальном оборудовании (диалоги идут только через центр — C, а эффекты через тылы — LFE, BL, BR), и в обычных условиях бытового стерео из-за большого динамического диапазона возникают неприятные эффекты (слишком тихие голоса и слишком громкие взрывы). Диапазон амплитуд остаётся тот же, но баланс каналов меняется, голоса становятся заметнее, т.к. центр суммируется с левым/правым каналами, эффекты могут уменьшиться по “объему” или сместиться по панораме. Динамический диапазон не уменьшается сам по себе, но на слух кажется “компрессированным”, потому что всё смешано и тихие голоса уже не теряются на фоне громких эффектов.

''mcedit ~/.config/mpv/mpv.conf''

''# Свести многоканальный звук в стерео''
''audio-channels=stereo''

При просмотре технических данных видео (через ''i'') будет выводиться информация об исходных параметрах, а реальный вывод будет, например:

''AO: [pulse] 48000Hz stereo 2ch float''

вместо

''AO: [pulse] 48000Hz 5.1(side) 6ch float''

Это можно проверить при явном запуске видеофайла через ''mpv'' в консоли.

===== Шорткаты =====

==== Стандартные ====

''#''	(shift+3) Поменять аудиодорожку 
''J''	Поменять дорожку с субтитрами
''I'' 	Техно информация (быстро исчезает, чтобы прочитать всё, надо удерживать клавишу)
''.''	Кадр вперед
'',''	Кадр назад
'']''	Увеличить скорость
''[''	Уменьшить скорость

Глянуть весь список параметров (их более тысячи, многие deprecated):

''mpv --list-options > mpv_options.txt && sublime mpv_options.txt''

==== Задать свои ====

Установить что-то на глобальные хоткеи вроде Ctrl+W нельзя, глобальные сочетания приоритетнее.

=== Смена аудиодорожки ===

''mcedit ~/.config/mpv/input.conf''

''# Смена аудиодорожки''
''Ctrl+1 cycle audio 1''
''Ctrl+2 cycle audio -1''

=== Смена субтитров ===

''mcedit ~/.config/mpv/input.conf''

''# Смена субтитров''
''Ctrl+3 cycle sub 1''
''Ctrl+4 cycle sub -1''

=== Изменение размера субтитров ===

''mcedit ~/.config/mpv/input.conf''

''# Изменение размера субтитров''
''Ctrl+5 add sub-font-size 6''
''Ctrl+6 add sub-font-size -6''

=== Скриншоты ===

Выполняются по клавише ''S''.

''mcedit ~/.config/mpv/mpv.conf''

Задать каталог для сохранения скриншотов:

''# каталог для сохранения скриншотов''
''screenshot-directory=/путь/к/каталогу''

Задать шаблон названия скриншотов:

''# название скриншотов''
''screenshot-template='%F-%n'''

Можно выводить и полное время через

''screenshot-template='%F-%P'''

но время отображается через двоеточие, и это может привести к сложностям с сохранением имени файла. Не нашел способ поменять двоеточие на нижнее подчеркивание в таймстампе на стороне mpv.

==== Субтитры ====

=== Размер субтитров ===

''mcedit ~/.config/mpv/mpv.conf''

''# Размер субтитров''
''sub-font-size=38''

Учесть, что в разных видеофайлах размер субтитров будет разным, и где-то 38 будет восприниматься как неудобно мелкий.

=== Задержка субтитров ===

Например, есть субтитры к сериалу, но они подготовлены для телеверсии, в которой каждая серия начинается с раздела «в предыдущих сериях». А ты смотришь набор серий, в которых все эти «в предыдущих» вырезаны. Условно, каждый раз надо запускать субтитры на минус 24 секунды (24 000 ms).

== Управление задержкой и опережением субтитров ==

Через клавиши ''x'' и ''z''. Более длинные смещения (по секунде) через ''shift+x'' и ''shift+z''. 

== Задать смещение субтитров из встоенной консоли mpv ==

* во время воспроизведения вызвать консоль через ''`'' (клавиша на Ё)
* написать (руками, вставить текст невозможно)
''set sub-delay -24''
* убрать командное окно через Esc

Можно и точнее: 24 секунды и 700 миллисекунд = ''24.7''

Если нужно поправить смещение: клавиши ''x'' и ''z''.

== Запускать файл сразу с заданным смещением субтитров ==

''mpv --sub-delay=-24 --sub-file=серия01.srt серия01.mkv''

Если субтитры вшиты — убрать параметр “''--sub-file''”.

Можно даже сделать алиас:

''alias mpvs='mpv --sub-delay=-24'''

== Обработать все файлы srt ==

Из командной строки можно сделать копию файла с субтитрами, в которых все тайминги смещены на эти самые 24 000 ms:

''ffmpeg -itsoffset -24 -i input.srt -c copy output.srt''

Пакетное применение:

''for f in *.srt; do''
	''ffmpeg -itsoffset -24 -i "$f" -c copy "fixed_$f"''
''done''

Но для этого нужны специфические предусловия, иначе повсюду начнутся ошибки. Поэтому сперва надо делать всё руками, и только потом автоматикой.
