Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2025-09-11T09:51:40+03:00

====== Переустановка Debian ======

[ @debian @install @backup ]

===== Бэкап =====

==== списка ПО ====

Сохранить список всего установленного ПО в системе в виде простого списка:

''apt-mark showmanual > packages_simple_list.txt''

Заглянуть в него и удалить что-то, что стало ненужным. Сохранить этот файл на внешний носитель — он понадобится позже. 

Можно получить тот же список с версиями пакетов:

''apt list --installed > packages_versions_list.txt''

==== списка репозиториев ====

Сохранить на внешний носитель копию каталогов

''/etc/apt/sources.list.d/''
''/etc/network/''

и файлов:

''/etc/apt/sources.list''
''/etc/hostname''
''/etc/hosts''
''/etc/fstab''

==== раздела /home/* ====

Удалить содержимое корзины.

Жестко [[Очистить кэш]] профиля.

Вынести из профиля крупные файлы вроде видео или книг.

Узнать UID своего юзера:

''id astenix''

Пример ответа:

'''
uid=1000(astenix) gid=1000(astenix)
'''
 — etc

Из-под root сохранить каталоги /home/ в большой архив без сжатия:

'''
tar -cf /mnt/backup/home-backup.tar /home/*
'''

Разумно сперва вытащить диск из системы и скопировать его содержимое через другой компьютер, потому что в работающей системе какие-то файлы всегда будут заблокированы.

==== hostname ====

'''
cat /etc/hostname
'''

===== Установить Debian заново =====

Собрать компьютер обратно (с заменой комплектующих, если надо), установить Debian стандартным способом.

Создать своего юзера с тем же именем. Если у него будет другой UID — 

==== Переустановить все пакеты ====

'''
xargs sudo apt install -y < packages_simple_list.txt
'''

==== Вернуть /home/* ====

Основной пользователь уже должен быть создан — проверить его UID. Если не совпадает с тем, который был ранее — поменять, иначе могут быть проблемы с правами на восстанавливаемые файлы/каталоги:

''usermod -u 1000 astenix''

Распаковать архив с /home*

'''
sudo tar -xf /mnt/backup/home-backup.tar -C /
'''

“''-C /”'' означает распаковать относительно корня (/), то есть содержимое архива /home/* снова встанет на своё место

Принять как факт, что не всё подхватится и заработает. Дальше см. [[Debian:Настроить систему]]
