Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.6
Creation-Date: 2025-06-23T06:57:41+03:00

====== Виджет «Календарь событий» ======

[ @calendar @widget @shortcuts ]

//temporary notice:// виджет еще не работает в “Plasma 6”

==== Заменить в трее часы на «Календарь событий» ====

'''
Правый клик мышью по часам в трее 
> Добавить виджеты
> В окне выбора виджетов выбрать [Пополнить список виджетов] 
> [Загрузить виджеты Plasma]
'''

'''
> В строке поиска написать «Event Calendar» 
> найти его и установить. 

'''
Если его там не будет, можно установить из https://github.com/Zren/plasma-applet-eventcalendar
'''

Правый клик мышью по часам в трее 
> «Взаимозаменяемые виджеты»
> выбрать «Календарь событий»
> [Заменить]
'''

==== Настроить внешний вид часов ====

'''
Правый клик мышью по часам в трее 
> настроить виджет «Календарь событий»
> Главная
'''

Опционально

* убрать галочку «Метеограмма» (для постоянного отображения прогноза погоды может быть удобнее отдельный +Виджет «Прогноз погоды»)
* убрать галочку «Таймер»

* Выбрать «Шрифт часов» — зависит от установленных шрифтов. Можно поставить курсор на поле выбора шрифта и покрутить колесо мыши.
	* Quicksand Medium — норм
	* IBM Plex Serif Text
	* Chivo Black — толсто, с засечками
	* Dante — толсто, вроде терминала, красиво
	* Open Sans Extra Bold — очень толсто, без засечек, красиво
	* Clear Sans — тонко
	* Helvetica — тонко
	* IBM Plex Sans Arabic Medm
	* IBM Plex Sans SemiBold
	* CO59[urw] — фигурно

В поле «Строка 1» можно вписать следующую инструкцию:

'''<font size="1" color="orange">48</font> <font size="2" color="#b8b2b2">'d MMM'</font>' HH:mm''

Первое число (48) — это номер недели в году. Он опционален. Чуть позже будет настроено его обновление.

Размеры шрифта здесь не в пикселях, можно указывать только значения в диапазоне от „1” (самый маленький) до „7“ (громадный). «Строка 2» можно не включать.

Первое число (22) — это номер недели. Хорошо бы обновлять его автоматически. В Linux за это отвечают две переменные:
* %U — week number of year, with Sunday as first day of week (00..53)
* %V — ISO week number, with Monday as first day of week (01..53) 
Подробнее см. https://www.cyberciti.biz/faq/linux-unix-formatting-dates-for-display/

Но в виджете не работают ни U, ни V.

Решение — вписывать нужное значение в конфиг-файл виджета, ''/home/astenix/.config/plasma-org.kde.plasma.desktop-appletsrc''

Это можно сделать в любой момент, но изменения в виджете применяются только после перезагрузки Plasma. Поэтому надо записывать номер недели  в файл настроек после запуска Plasma, но ДО загрузки моего профиля. Для этого я сделаю отдельный sh-скрипт, который будет запускаться при инициализации профиля.

В принципе можно не заводить это всё в отдельный sh-файл а записать три строки прямо в файл ''~/.bash_profile'', но тогда будет больше шансов продолбать этот файл при очередной переустановке системы.

=== Сделать скрипт ===

''mcedit /home/astenix/myScripts/kde/update_widget_EventCalendar.sh''

Этот скрипт читает содержимое файла с настройками виджета (fileToUpdate), находит в нём строку со временем и вставляет вместо числа „22” (которое постоянно меняется) содержимое из переменной “weekNumber” актуальный номер недели.

'''
#!/bin/bash
export TERM=linux

fileToUpdate="/home/astenix/.config/plasma-org.kde.plasma.desktop-appletsrc"
weekNumber=$(date +%V)

	# Обычно кавычки по бокам ординарные, но с ними переменная $weekNumber воспринимается как простой текст
	# чтобы подставлялось значение из переменной, надо весь запрос обрамлять снаружи двойными кавычками, и если они 
	# есть внутри запроса — экранировать их обратным слэшем, а ординарные экранировать не надо. Также надо экранировать
	# слэши из html. И ещё надо взять в двойные кавычки переменную с адресом файла, который надо обновить.

sed -E -i "s/clockTimeFormat1='<font size=\"1\" color=\"orange\">([0-9]+)<\/font>/clockTimeFormat1='<font size=\"1\" color=\"orange\">$weekNumber<\/font>/g" "$fileToUpdate"
'''

=== Сделать скрипт исполняемым ===

''chmod +x /home/astenix/myScripts/kde/update_widget_EventCalendar.sh''

=== Запланировать запуск скрипта ===

Обновить файл настроек виджета надо после запуска Plasma, но ДО загрузки моего профиля.

''mcedit ~/.bash_profile''

Вставить этот текст:

''if [ -f /home/astenix/myScripts/kde/update_widget_EventCalendar.sh ]; then    # проверяем, что sh-файл существует.''
	''. /home/astenix/myScripts/kde/update_widget_EventCalendar.sh                # если да, то выполняем его ПЕРЕД загрузкой профиля''

Теперь при каждой загрузке профиля (или при каждом включении ноута, если угодно) будет выполняться обновление предопределенной строки в настройках виджета. 

Есть смысл протестировать выполнение этого скрипта в полночь на понедельник.

=== Настроить «Команды запуска» ===

''> Главная'' 
''> Колесо мыши''

Возможность управлять громкостью звука колесом мыши, когда курсор над часами в трее. При уменьшении хорошо бы установить порог срабатывания в 15%, чтобы уменьшить звук быстро.

* Выбрать «Регулировка (без интерфейса) amixer»
* Прокрутка вверх = ''amixer -q sset Master 15%+''
* Прокрутка вниз = ''amixer -q sset Master 15%-''

Если нужно зримое отображение прогесс-бара при смене уровня звука, то лучше тыкнуть по «Регулировка (с интерфейсом) (qdbus)». В полях «Команды запуска» появятся команды
* ''qdbus org.kde.kglobalaccel /component/kmix invokeShortcut "increase_volume"''
* ''qdbus org.kde.kglobalaccel /component/kmix invokeShortcut "decrease_volume"''

=== Убрать галочку «Показать фон» ===

''> Главная'' 
''> Другое''

* Убрать галочку «Виджет рабочего стола: показать фон»

==== > Макет ====

Распорядок дня под календарём (Одна колонка)

==== > Часовые пояса ====

По-необходимости.

==== > Календарь ====

Чтобы добавить гуглокалендарь, в KDE обязательно надо включить использование бумажника для хранения паролей. Для бумажника можно (хотя и не очень нужно) задать пустой пароль — [[Сделать:Поменять пароль в кошельке kdewallet]]

И надо установить ''kdepim'' (KDE Personal Information Management):

''sudo aptitude install kalendar kdepim''

Галочки

* Показать календарь
* Показать номера недель
* Подсветка текущего дня/недели
* Первый день: понедельник
* Значок события: Точки
* Сегодняшний день: Светлая (на тёмном)

==== > Обзор дня ====

* галочка «Показать обзор дня» (выводить информацию о событиях в календаре)
* убрать галочку «Описание события»

==== > События ====

* убрать галочку «Праздники»
* поставить галочку «Модуль событий электронного секретаря»
* Обновлять события каждые «''60 min''»

==== > Google Calendar ====

Прямое подключение к календарю гугл черз виджет Event Calendar уже не работает и вряд ли будет. Надо подключить календарь через KOrganizer, который использует kdepim. Уже после этого настроить отображение своего календаря в виджете Event Calendar в разделе «Модуль событий электронного секретаря» — поставить галочки для календарей, которые должны отображаться в виджете (так работает Akonadi).

==== > Погода ====

Кишинев = ''618426''

==== > Модуль событий электронного секретаря ====

Убедиться в том, что добавленные в KOrganizer календари отображаются.

Развернуть из и проставить галочки для гуглокалендарей, которые надо отображать в виджете. [OK]

Развернуть виджет, в правом нижнем углу кликнуть по иконе „Reload”.

==== > Комбинации клавиш ====

Может быть удобно разворачивать представление календаря по нажатию ''Ctrl+F11'' или ''Ctrl+ScrollLock''.

[OK]
